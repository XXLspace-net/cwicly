class CCPopover{constructor(e){this.$el=e,this.animation=e.getAttribute("data-ccp-animation"),this.delayParsed=e.getAttribute("data-ccp-delay")?JSON.parse(e.getAttribute("data-ccp-delay")):null,this.delay=this.delayParsed?1e3*this.delayParsed[0]:null,this.delayOut=this.delayParsed?1e3*this.delayParsed[1]:null,this.interactive=e.getAttribute("data-ccp-interactive"),this.disableFocus=e.getAttribute("data-ccp-disable-focus"),this.shift=e.getAttribute("data-ccp-shift"),this.flip=e.getAttribute("data-ccp-flip"),this.offset=e.getAttribute("data-ccp-offset"),this.placement=e.getAttribute("data-ccp-placement"),this.position=e.getAttribute("data-ccp-position"),this.triggerID=e.getAttribute("data-ccp-trigger"),this.hideType=e.getAttribute("data-ccp-hide"),this.trigger=e.getAttribute("data-ccp-trigger_type"),this.args,this.$trigger=document.querySelector(`#${this.triggerID}`),this.$trigger&&this.$el&&(this.init(),this.events()),this.outsideListener=this.outsideListener.bind(this),this.handleInteractive=this.handleInteractive.bind(this).ccThrottle(50),this.mouseLeaveListener=this.mouseLeaveListener.bind(this),this.handleMouseEnter=this.handleMouseEnter.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.mouseEnterListener=this.mouseEnterListener.bind(this),this.mouseTriggerEnterListener=this.mouseTriggerEnterListener.bind(this),this.removeVideo=this.removeVideo.bind(this),this.mouseHoverTimeout,this.mouseEnterTimeout,this.floatPlacement,this.isListeningMouseOut=!1,this.isTriggering=!1,this.isInteracting=!1,this.isOverridden=!1,this.onKeydown=this.handleKey.bind(this),this.isOpen=!1,this.updatePosition=this.updatePosition.bind(this),this.cleanupRef}updatePosition(){FloatingUIDOM.computePosition(this.$trigger,this.$el,this.args).then(({x:e,y:t,placement:i})=>{this.floatPlacement=i,Object.assign(this.$el.style,{left:`${e}px`,top:`${t}px`,position:this.position?this.position:"absolute"}),this.$el.setAttribute("data-ccp-placement",i)})}cleanup(){FloatingUIDOM.autoUpdate(this.$trigger,this.$el,this.updatePosition)}init(){const e={middleware:[]};this.placement&&(e.placement=this.placement),this.offset&&e.middleware.push(FloatingUIDOM.offset(parseInt(this.offset))),this.shift&&e.middleware.push(FloatingUIDOM.shift()),this.flip&&e.middleware.push(FloatingUIDOM.flip()),this.position&&(e.position=this.position),this.args=e,this.$trigger.setAttribute("aria-expanded","false"),this.$trigger.setAttribute("data-ccp-state","closed"),FloatingUIDOM.computePosition(this.$trigger,this.$el,e).then(({x:e,y:t,placement:i})=>{this.floatPlacement=i,Object.assign(this.$el.style,{left:`${e}px`,top:`${t}px`,position:this.position?this.position:"absolute"}),this.$el.setAttribute("data-ccp-placement",i)})}events(){"click"===this.trigger?this.$trigger.addEventListener("click",this.handleClick.bind(this)):"hover"===this.trigger&&this.$trigger.addEventListener("pointerenter",this.handleMouseEnter.bind(this)),this.$trigger.addEventListener("focus",this.handleFocus.bind(this)),this.$trigger.addEventListener("blur",this.handleBlur.bind(this))}open(){this.$el.setAttribute("data-ccp-state","visible"),this.$trigger.setAttribute("aria-expanded","true"),this.$trigger.setAttribute("data-ccp-state","open"),this.isOpen=!0,"click"===this.trigger&&(setTimeout(()=>{this.setFocusToFirstNode()},100),this.$el.addEventListener("keydown",this.onKeydown,!1));const e=new CustomEvent("data-popover",{detail:{id:this.$el.id,state:"open"}});document.dispatchEvent(e),this.cleanup()}close(){this.$el.setAttribute("data-ccp-state","hidden"),this.$trigger.setAttribute("aria-expanded","false"),this.$trigger.setAttribute("data-ccp-state","closed"),this.isOpen=!1,"click"===this.trigger&&this.$el.removeEventListener("keydown",this.onKeydown);const e=new CustomEvent("data-popover",{detail:{id:this.$el.id,state:"closed"}});document.dispatchEvent(e),this.cleanupRef}getFocusableNodes(){const e=this.$el.querySelectorAll(["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])']);return Array(...e)}retainFocus(e){if(this.disableFocus)return;let t=this.getFocusableNodes();if(0!==t.length)if(t=t.filter(e=>null!==e.offsetParent),this.$el.contains(document.activeElement)){const i=t.indexOf(document.activeElement);e.shiftKey&&0===i&&(t[t.length-1].focus(),e.preventDefault()),!e.shiftKey&&t.length>0&&i===t.length-1&&(t[0].focus(),e.preventDefault())}else e.preventDefault(),t[0].focus()}setFocusToFirstNode(){if(this.disableFocus)return;const e=this.getFocusableNodes();if(0===e.length)return;const t=e.filter(e=>!e.classList.contains("close"));t.length>0&&t[0].focus(),0===t.length&&e[0].focus()}handleKey(e){27===e.keyCode&&this.isOpen&&this.hide(this.delayOut),9===e.keyCode&&this.retainFocus(e)}handleClick(e){"hidden"!==this.$el.getAttribute("data-ccp-state")||this.isTriggering?this.hide(this.delayOut):this.show(this.delay)}handleMouseEnter(e){"hidden"!==this.$el.getAttribute("data-ccp-state")||this.isTriggering||(this.show(this.delay),this.interactive&&(document.addEventListener("pointermove",this.handleInteractive),this.isListeningMouseOut=!0))}handleMouseLeave(e){"visible"!==this.$el.getAttribute("data-ccp-state")||this.isTriggering||this.hide(this.delayOut)}handleFocus(e){"hidden"!==this.$el.getAttribute("data-ccp-state")||this.isTriggering||"click"===this.trigger||this.show(this.delay)}handleBlur(e){"visible"!==this.$el.getAttribute("data-ccp-state")||this.isTriggering||"click"===this.trigger||this.hide(this.delayOut)}handleInteractive(e){this.$trigger.contains(e.target)||this.$el.contains(e.target)||"visible"!==this.$el.getAttribute("data-ccp-state")||!function(e,t,i,s){const{clientX:n,clientY:r}=s,{top:o,left:h,bottom:a,right:d}=e.getBoundingClientRect(),l=function(e){return e.split("-")[0]}(t),c=i?parseInt(i):0;return!c||o-r-("bottom"===l?c:0)>0||r-a-("top"===l?c:0)>0||h-n-("right"===l?c:0)>0||n-d-("left"===l?c:0)>0}(this.$el,this.floatPlacement,this.offset,e)||this.isInteracting||(this.isInteracting=!0,this.delayOut?(this.$el.addEventListener("pointerenter",this.mouseEnterListener),this.$trigger.addEventListener("pointerenter",this.mouseTriggerEnterListener),this.mouseEnterTimeout=setTimeout(()=>{this.hide(),document.removeEventListener("pointermove",this.handleInteractive),this.$el.removeEventListener("pointerenter",this.mouseEnterListener),this.$trigger.removeEventListener("pointerenter",this.mouseTriggerEnterListener),this.isListeningMouseOut=!1,this.isInteracting=!1},this.delayOut)):(this.hide(),document.removeEventListener("pointermove",this.handleInteractive),this.isListeningMouseOut=!1,this.isInteracting=!1))}show(e=0){if(!this.isOverridden)if(this.isTriggering=!0,"click"===this.trigger)e?"hidden"===this.$el.getAttribute("data-ccp-state")&&setTimeout(()=>{this.open(),document.addEventListener("click",this.outsideListener),this.isTriggering=!1},e):(this.open(),document.addEventListener("click",this.outsideListener),this.isTriggering=!1);else if("hover"===this.trigger||"focus"===this.trigger)if(this.interactive){const t=document.querySelectorAll("iframe"),i=document.querySelectorAll("video");t.length>0&&t.forEach(e=>{e.style.pointerEvents="none"}),i.length>0&&i.forEach(e=>{e.style.pointerEvents="none"}),e?this.isListeningMouseOut||(this.$trigger.addEventListener("pointerout",this.mouseLeaveListener),this.mouseHoverTimeout=setTimeout(()=>{this.open(),document.addEventListener("pointermove",this.handleInteractive),this.isTriggering=!1,this.isListeningMouseOut=!0,this.$trigger.removeEventListener("pointerout",this.mouseLeaveListener)},e)):(this.open(),document.addEventListener("pointermove",this.handleInteractive),this.isTriggering=!1,this.isListeningMouseOut=!0)}else e?(this.$trigger.addEventListener("pointerout",this.mouseLeaveListener),this.mouseHoverTimeout=setTimeout(()=>{this.open(),this.isTriggering=!1,this.$trigger.removeEventListener("pointerout",this.mouseLeaveListener),this.$trigger.addEventListener("pointerout",this.handleMouseLeave.bind(this))},e)):(this.open(),this.isTriggering=!1,this.$trigger.addEventListener("pointerout",this.handleMouseLeave.bind(this)))}hide(e=0){if(!this.isOverridden){if(this.interactive){const e=document.querySelectorAll("iframe"),t=document.querySelectorAll("video");e.length>0&&e.forEach(e=>{e.style.removeProperty("pointer-events")}),t.length>0&&t.forEach(e=>{e.style.removeProperty("pointer-events")})}if(e)"visible"===this.$el.getAttribute("data-ccp-state")&&setTimeout(()=>{"click"===this.trigger?(this.close(),document.removeEventListener("click",this.outsideListener)):this.close()},e);else{if("click"===this.trigger?(this.close(),document.removeEventListener("click",this.outsideListener)):this.close(),0===this.$el.querySelectorAll("iframe").length&&0===this.$el.querySelectorAll("video").length)return;this.$el.addEventListener("transitionend",this.removeVideo)}}}removeVideo(){const e=this.$el.innerHTML;this.$el.innerHTML=e,this.$el.removeEventListener("transitionend",this.removeVideo)}showHide(e=0,t=0){this.isOverridden||(this.isOverridden=!0,e?"hidden"===this.$el.getAttribute("data-ccp-state")&&setTimeout(()=>{this.open(),this.isOverridden=!1},e):(this.open(),this.isOverridden=!1),t?setTimeout(()=>{"visible"===this.$el.getAttribute("data-ccp-state")&&(this.close(),this.isOverridden=!1)},t+e):"visible"===this.$el.getAttribute("data-ccp-state")&&(this.close(),this.isOverridden=!1))}outsideListener(e){"click"===this.trigger&&(("onClick"!==this.hideType||this.$trigger.contains(e.target))&&("onClickOut"!==this.hideType||this.$trigger.contains(e.target)||this.$el.contains(e.target))?"onClickIn"===this.hideType&&!this.$trigger.contains(e.target)&&this.$el.contains(e.target)&&this.hide(this.delayOut):this.hide(this.delayOut))}mouseLeaveListener(){clearTimeout(this.mouseHoverTimeout),this.mouseHoverTimeout=null,this.isTriggering=!1,this.isListeningMouseOut=!1,this.$trigger.removeEventListener("pointerout",this.mouseLeaveListener),document.removeEventListener("pointermove",this.handleInteractive)}mouseEnterListener(){clearTimeout(this.mouseEnterTimeout),this.mouseEnterTimeout=null,this.$el.removeEventListener("pointerenter",this.mouseEnterListener),this.isInteracting=!1}mouseTriggerEnterListener(){clearTimeout(this.mouseEnterTimeout),this.mouseEnterTimeout=null,this.$trigger.removeEventListener("pointerenter",this.mouseTriggerEnterListener),this.isInteracting=!1}destroy(){"click"===this.trigger?(this.$trigger.removeEventListener("click",this.clickListener),document.removeEventListener("click",this.outsideListener)):(this.$trigger.removeEventListener("pointerenter",this.mouseEnterListener),this.$trigger.removeEventListener("pointerenter",this.mouseTriggerEnterListener),this.$trigger.removeEventListener("pointerout",this.mouseLeaveListener),this.$trigger.removeEventListener("pointermove",this.handleInteractive))}}window.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll("[data-ccp-trigger_type]");e&&e.forEach(e=>{window[`cc-popover-${e.id}`]=new CCPopover(e)}),document.addEventListener("cc-popovers",e=>{window[`cc-popover-${e.detail.id}`]?(window[`cc-popover-${e.detail.id}`].destroy(),window[`cc-popover-${e.detail.id}`]=new CCPopover(document.querySelector(`#${e.detail.id}`))):e.detail.id&&document.querySelector(`#${e.detail.id}`)&&!window[`cc-popover-${e.detail.id}`]&&(window[`cc-popover-${e.detail.id}`]=new CCPopover(document.querySelector(`#${e.detail.id}`)))})}),Function.prototype.ccThrottle=function(e,t){var i=this,s=null,n=e;return function(){var e=t||this,r=arguments,o=Date.now();(!s||o-s>=n)&&(s=o,i.apply(e,r))}};